# --------------------------------------------------------
# üß© CodeQL Scan ‚Äî –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∏–π SAST-–∞–Ω–∞–ª—ñ–∑ –∫–æ–¥—É –≤ GitHub
# –ü–µ—Ä–µ–≤—ñ—Ä—è—î –∫–æ–¥ –Ω–∞ –≤—Ä–∞–∑–ª–∏–≤–æ—Å—Ç—ñ (SQLi, XSS, Command Injection —Ç–æ—â–æ)
# –ó–∞–ø—É—Å–∫–∞—î—Ç—å—Å—è –ø—Ä–∏ –∫–æ–º—ñ—Ç–∞—Ö, pull request'–∞—Ö —ñ —â–æ—Ç–∏–∂–Ω—è –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º
# --------------------------------------------------------

name: CodeQL Scan

on:
  workflow_dispatch: {}
  # üîπ –ó–∞–ø—É—Å–∫ –∞–Ω–∞–ª—ñ–∑—É –ø—Ä–∏ –∫–æ–∂–Ω–æ–º—É push —É –≥–æ–ª–æ–≤–Ω—É –≥—ñ–ª–∫—É
  push:
    branches: [ main ]

  # üîπ –ê–Ω–∞–ª—ñ–∑ –∑–º—ñ–Ω —É pull request –¥–æ main
  pull_request:
    branches: [ main ]

  # üîπ –ü–ª–∞–Ω–æ–≤–∏–π —â–æ—Ç–∏–∂–Ω–µ–≤–∏–π –∑–∞–ø—É—Å–∫ (–ø–æ–Ω–µ–¥—ñ–ª–æ–∫ –æ 10:19 UTC)
  schedule:
    - cron: '19 10 * * 1'

jobs:
  analyze:
    # üîπ GitHub Runner ‚Äî —Å–µ—Ä–µ–¥–æ–≤–∏—â–µ, –¥–µ –≤–∏–∫–æ–Ω—É—é—Ç—å—Å—è –¥—ñ—ó
    runs-on: ubuntu-latest

    # üîπ –î–æ–∑–≤–æ–ª–∏, —è–∫—ñ –ø–æ—Ç—Ä—ñ–±–Ω—ñ –¥–ª—è —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –∑–≤—ñ—Ç—É —É –≤–∫–ª–∞–¥—Ü—ñ Security
    permissions:
      security-events: write   # –¥–æ–∑–≤—ñ–ª –ø—É–±–ª—ñ–∫—É–≤–∞—Ç–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏ —Å–∫–∞–Ω—É–≤–∞–Ω–Ω—è
      contents: read           # –¥–æ—Å—Ç—É–ø –¥–ª—è —á–∏—Ç–∞–Ω–Ω—è —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—é

    steps:
      # --------------------------------------------------------
      # 1Ô∏è‚É£ –ó–∞–≤–∞–Ω—Ç–∞–∂—É—î–º–æ –∫–æ–¥ —ñ–∑ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—é
      # --------------------------------------------------------
      - name: Checkout repository
        uses: actions/checkout@v4

      # --------------------------------------------------------
      # 2Ô∏è‚É£ –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑—É—î–º–æ CodeQL
      #    –ú–æ–∂–Ω–∞ –≤–∫–∞–∑–∞—Ç–∏ –æ–¥–Ω—É –∞–±–æ –∫—ñ–ª—å–∫–∞ –º–æ–≤ –ø—Ä–æ–≥—Ä–∞–º—É–≤–∞–Ω–Ω—è
      #    "security-extended" ‚Äî –æ—Å–Ω–æ–≤–Ω—ñ –ø—Ä–∞–≤–∏–ª–∞ –±–µ–∑–ø–µ–∫–∏
      #    "security-and-quality" ‚Äî –¥–æ–¥–∞—Ç–∫–æ–≤–æ —Å—Ç–∏–ª—å —ñ —è–∫—ñ—Å—Ç—å
      # --------------------------------------------------------
      - name: Initialize CodeQL
        uses: github/codeql-action/init@v3
        with:
          languages: python
          queries: security-extended, security-and-quality, ./.github/codeql/custom-queries
          # üîπ –ü—ñ–¥–∫–ª—é—á–∞—î–º–æ –≤–ª–∞—Å–Ω—É –¥–∏—Ä–µ–∫—Ç–æ—Ä—ñ—é –∑ –ø—Ä–∞–≤–∏–ª–∞–º–∏
      # --------------------------------------------------------
      # 3Ô∏è‚É£ –í–∏–∫–æ–Ω—É—î–º–æ –∞–Ω–∞–ª—ñ–∑ —ñ —Ñ–æ—Ä–º—É—î–º–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏
      #    –†–µ–∑—É–ª—å—Ç–∞—Ç–∏ –∑‚Äô—è–≤–ª—è—Ç—å—Å—è —É –≤–∫–ª–∞–¥—Ü—ñ ‚ÄúSecurity ‚Üí Code scanning alerts‚Äù
      # --------------------------------------------------------
      - name: Perform CodeQL Analysis
        uses: github/codeql-action/analyze@v3
